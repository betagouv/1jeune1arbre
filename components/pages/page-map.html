<script>
  async function connected() {
    const pois = await store.actions.loadPois()
    const map = L.map(this.document.querySelector("#map")).setView([46.8,3.4], 6)

    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map)
    console.debug(pois)
    pois.forEach((poi) => 
      L.marker([poi.latitude, poi.longitude])
      .bindPopup(`
        <h2><img src="https://admin.1jeune1arbre.fr/assets/${poi.logo}?key=system-small-contain">${poi.title}</h2>
        <p>${poi.description}</p>
        <address>${poi.department} (${poi.region})</address>
        <h3>Prendre contact</h3>
        <ul>
          <li :if="poi.phone">tél : ${poi.phone}</li>
          <li :if="poi.email">email : <a href="mailto:${poi.website}?subject=1 jeune 1 arbre…">${poi.email}</a></li>
          <li :if="poi.website">site internet : <a href="${poi.website}" target="_blank">${poi.website}</a></li>
        </ul>
      `)
      .addTo(map)
    )
  }
</script>

<template>
  <div class="fr-container fr-py-6w">
    <div class="fr-grid-row fr-grid-row--gutters">
      <h2>Carte des plantations</h2>
    </div>
    <div class="fr-col-12">
      <div id="map"></div>
    </div>
  </div>
</template>

<style>
  #map {
    height: 500px;
    width: 100%;
    max-width: 100%;
    max-height: 100%;
  }
</style>
